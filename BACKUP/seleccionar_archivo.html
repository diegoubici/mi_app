<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Seleccionar archivo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <div class="card shadow-lg p-4">
      <h3 class="text-center mb-4">Bienvenido, {{ usuario }}</h3>

      <h5>Seleccionar un archivo existente</h5>
      {% if archivos %}
        <ul class="list-group mb-4">
          {% for archivo in archivos %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ archivo }}
              <a href="{{ url_for('abrir_archivo', nombre=archivo) }}" class="btn btn-sm btn-primary">Abrir</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No hay archivos aún.</p>
      {% endif %}

      <hr>

      <h5>Crear un nuevo archivo Excel</h5>
      <div class="input-group mb-3">
        <input type="text" id="nuevo_nombre" class="form-control" placeholder="Nombre del nuevo archivo (sin .xlsx)">
        <button class="btn btn-success" id="btn_crear">Crear</button>
      </div>

      <div id="mensaje" class="mt-3"></div>

      <a href="{{ url_for('logout') }}" class="btn btn-outline-danger mt-4">Cerrar sesión</a>
    </div>
  </div>

  <script>
    $("#btn_crear").click(function() {
      const nombre = $("#nuevo_nombre").val().trim();
      if (!nombre) {
        $("#mensaje").html('<div class="alert alert-warning">Ingrese un nombre válido.</div>');
        return;
      }
      $.post("/nuevo_archivo", { nombre: nombre }, function(resp) {
        if (resp.success) {
          $("#mensaje").html('<div class="alert alert-success">Archivo creado correctamente. <a href="/abrir/' + resp.archivo + '">Abrir ahora</a></div>');
        } else {
          $("#mensaje").html('<div class="alert alert-danger">' + resp.message + '</div>');
        }
      });
    });
  </script>
</body>
</html>
